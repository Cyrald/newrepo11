# –û–¢–ß–ï–¢ ‚Ññ5
## –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ e-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞:** 28 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤  
**–°—Ç–µ–∫:** React + Vite, Express + Node.js, PostgreSQL + Drizzle ORM  
**–û–±—ä–µ–º –∫–æ–¥–∞:** ~6000 —Å—Ç—Ä–æ–∫ (128 TypeScript —Ñ–∞–π–ª–æ–≤: 22 backend, 106 frontend)  

---

## EXECUTIVE SUMMARY

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é e-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–æ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –í—ã—è–≤–ª–µ–Ω–æ **8 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (—É–º–µ—Ä–µ–Ω–Ω–æ–π –∏ –Ω–∏–∑–∫–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏), **3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–∏—Å–∫–∞** –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–ª–∞—Å—Ç–µ–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:** 8.2/10

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞
‚úÖ –ß–µ—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º frontend/backend  
‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (rate limiting, CORS, CSRF, session security)  
‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å TypeScript + Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è  
‚úÖ –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ constraints  
‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å ImagePipeline (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, cleanup)  
‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (2084 —Å—Ç—Ä–æ–∫–∏ TODO.md)  

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
üî¥ **CRITICAL**: Rate limiting –∏—Å–ø–æ–ª—å–∑—É–µ—Ç in-memory storage (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è production)  
üî¥ **CRITICAL**: WebSocket endpoint –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ rate limiting  
üî¥ **HIGH**: 8 npm —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (csurf deprecated, cookie vulnerability, drizzle-kit)  
üü° **MEDIUM**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ WebSocket reconnection strategy –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ  
üü° **MEDIUM**: –û–¥–∏–Ω TODO –≤ –∫–æ–¥–µ (newsletter subscription)  

---

## 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### 1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
‚îú‚îÄ‚îÄ client/                     # React Frontend (106 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/        # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã + shadcn/ui
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/             # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/            # Zustand state management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/               # –£—Ç–∏–ª–∏—Ç—ã, API –∫–ª–∏–µ–Ω—Ç, WebSocket
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/             # Custom React hooks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/         # Context providers
‚îú‚îÄ‚îÄ server/                     # Express Backend (22 —Ñ–∞–π–ª–∞)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, CSRF
‚îÇ   ‚îú‚îÄ‚îÄ routes.ts              # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.ts               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (session-based)
‚îÇ   ‚îú‚îÄ‚îÄ ImagePipeline.ts       # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ db.ts                  # Database connection
‚îú‚îÄ‚îÄ shared/                     # –û–±—â–∏–π –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts              # Drizzle ORM —Å—Ö–µ–º—ã + Zod
‚îú‚îÄ‚îÄ uploads/                    # –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îú‚îÄ‚îÄ products/              # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ chat/                  # –í–ª–æ–∂–µ–Ω–∏—è —á–∞—Ç–∞
‚îî‚îÄ‚îÄ drizzle/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

**–ê–Ω–∞–ª–∏–∑:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º monorepo –¥–ª—è full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ `client`, `server`, `shared` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–µ—Ç–∫—É—é –∏–∑–æ–ª—è—Ü–∏—é —Å–ª–æ–µ–≤. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `shared` –¥–ª—è —Å—Ö–µ–º –ë–î –∏ —Ç–∏–ø–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞.

### 1.2 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

#### Frontend
- **Framework:** React 18 + TypeScript
- **Routing:** Wouter (lightweight alternative to React Router)
- **State Management:** Zustand (client/src/stores/authStore.ts, cartStore.ts)
- **Forms:** React Hook Form + Zod validation
- **Data Fetching:** TanStack Query (React Query v5)
- **UI Library:** Shadcn UI (Radix UI primitives + Tailwind CSS)
- **Styling:** Tailwind CSS + tailwindcss-animate
- **Real-time:** WebSocket client (client/src/lib/websocket.ts)

**–û—Ü–µ–Ω–∫–∞:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, production-ready —Å—Ç–µ–∫. Wouter - –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è bundle size. Zustand + React Query –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

#### Backend
- **Runtime:** Node.js + Express
- **Database:** PostgreSQL (Neon serverless)
- **ORM:** Drizzle ORM
- **Authentication:** Session-based (express-session + connect-pg-simple)
- **File Upload:** Multer + Sharp (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- **Validation:** Zod schemas
- **WebSocket:** ws library
- **Security:** helmet, cors, express-rate-limit, csurf

**–û—Ü–µ–Ω–∫–∞:** –ù–∞–¥–µ–∂–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è enterprise –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. Session-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —á–µ–º JWT –≤ localStorage.

### 1.3 –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Repository Pattern** (–Ω–µ—è–≤–Ω—ã–π —á–µ—Ä–µ–∑ Drizzle ORM)
2. **Middleware Chain** (Express middleware –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
3. **Error Handler Pattern** (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ server/middleware/errorHandler.ts)
4. **Factory Pattern** (ImagePipeline –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
5. **Singleton Pattern** (WebSocket client, database connection pool)
6. **Provider Pattern** (React context providers –¥–ª—è auth, theme)

---

## 2. –ê–ù–ê–õ–ò–ó –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 2.1 –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 2.1.1 Rate Limiting (server/middleware/rateLimiter.ts)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
authLimiter: 15 requests / 15 minutes
registerLimiter: 5 requests / hour
uploadLimiter: 30 uploads / hour
searchLimiter: 60 searches / minute
promocodeValidationLimiter: 20 validations / hour
generalApiLimiter: 120 requests / minute (–≤—Å–µ /api/*)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è **CRITICAL –¥–ª—è production**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `MemoryStore` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –õ–∏–º–∏—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ (multiple instances)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Redis (VPS deployment)
import RedisStore from 'rate-limit-redis';
import { createClient } from 'redis';

const redisClient = createClient({ url: process.env.REDIS_URL });
redisClient.connect();

export const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 15,
  store: new RedisStore({
    client: redisClient,
    prefix: 'rl:auth:',
  }),
});
```

#### 2.1.2 CORS Protection (server/index.ts)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
const allowedOrigins = env.NODE_ENV === 'production'
  ? [env.FRONTEND_URL, env.REPLIT_DEV_DOMAIN].filter(Boolean)
  : true; // Development: –≤—Å–µ origins –¥–ª—è Vite HMR

app.use(cors({
  origin: allowedOrigins,
  credentials: true,
}));
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è. Production whitelist –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç CSRF –∞—Ç–∞–∫ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `FRONTEND_URL` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ production.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
if (env.NODE_ENV === 'production' && !env.FRONTEND_URL) {
  throw new Error('FRONTEND_URL must be set in production');
}
```

#### 2.1.3 Session Security

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (server/index.ts:75-93):**
```typescript
app.use(session({
  store: new pgSimpleStore({ pool }),
  secret: env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: {
    httpOnly: true,
    secure: env.NODE_ENV === 'production',
    sameSite: 'lax',
    maxAge: 7 * 24 * 60 * 60 * 1000, // 7 –¥–Ω–µ–π
  },
}));
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- `httpOnly: true` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS (JavaScript –Ω–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å cookie)
- `secure: true` –≤ production - —Ç–æ–ª—å–∫–æ HTTPS
- `sameSite: 'lax'` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
- PostgreSQL store - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ó–∞—â–∏—Ç–∞ –æ—Ç Session Fixation (server/routes.ts:151):**
```typescript
req.session.regenerate((err) => { ... }); // –ù–æ–≤–∞—è session ID –ø–æ—Å–ª–µ login
```

#### 2.1.4 CSRF Protection (server/middleware/csrf.ts)

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç deprecated –ø–∞–∫–µ—Ç `csurf`

**NPM Audit:**
```
csurf: severity: low
  - Vulnerability: cookie out of bounds characters
  - Affected: csurf >= 1.3.0
  - Fix available: downgrade to 1.2.2 (breaking change)
```

**–°—Ç–∞—Ç—É—Å:** –ü–∞–∫–µ—Ç `csurf` –æ–±—ä—è–≤–ª–µ–Ω deprecated —Å –º–∞—Ä—Ç–∞ 2024. Express team —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
```typescript
// Option 1: csrf-csrf (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
import { doubleCsrf } from 'csrf-csrf';

const { generateToken, doubleCsrfProtection } = doubleCsrf({
  getSecret: () => process.env.CSRF_SECRET,
  cookieName: 'x-csrf-token',
  cookieOptions: { sameSite: 'lax', secure: true },
});

// Option 2: Custom implementation —Å SameSite cookies
// –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ sameSite='strict' –∏ session-based auth,
// CSRF —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ endpoints
```

#### 2.1.5 File Upload Security (server/ImagePipeline.ts)

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** maxFileSize: 50MB (product: 1200x1200, chat: 800x800)
2. **–§–æ—Ä–º–∞—Ç:** –¢–æ–ª—å–∫–æ JPEG, PNG, WEBP
3. **Dimension limits:** max 10000x10000px (DoS protection)
4. **MIME type validation:** Sharp library –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
5. **Filename sanitization:** `${Date.now()}-${randomUUID()}.webp`
6. **Automatic cleanup:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç:
- Decompression bombs (dimension limits)
- Path traversal (UUID filenames)
- MIME type spoofing (Sharp validation)
- Resource leaks (periodic cleanup)

**–£–ª—É—á—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ Content-Type header –ø—Ä–∏ upload:
```typescript
fileFilter: (req, file, cb) => {
  const allowedMimes = ['image/jpeg', 'image/png', 'image/webp'];
  if (!allowedMimes.includes(file.mimetype)) {
    return cb(new Error('Invalid file type'));
  }
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Content-Type header
  const contentType = req.headers['content-type'];
  if (!contentType?.includes('multipart/form-data')) {
    return cb(new Error('Invalid request format'));
  }
  cb(null, true);
}
```

#### 2.1.6 Input Sanitization

**Zod schemas (shared/schema.ts):**
- Email –≤–∞–ª–∏–¥–∞—Ü–∏—è: `.email().toLowerCase()`
- –ü–∞—Ä–æ–ª—å: `.min(8, "–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤")`
- Phone: regex –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
- Text fields: max length constraints

**SQL Injection:** ‚úÖ Drizzle ORM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç prepared statements (–ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞)

**XSS Protection:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è
- Backend: –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è Zod schemas
- Frontend: React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ JSX
- **–†–∏—Å–∫:** –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `dangerouslySetInnerHTML` (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ)

#### 2.1.7 WebSocket Security

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (client/src/lib/websocket.ts):**
```typescript
connect(userId: string) {
  this.socket = new WebSocket(wsUrl);
  this.socket.onopen = () => {
    this.send({ type: 'auth', userId: this.userId }); // –ü—Ä–æ—Å—Ç–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  };
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:** üî¥ **CRITICAL**
1. **–ù–µ—Ç server-side –≤–∞–ª–∏–¥–∞—Ü–∏–∏ userId** - –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å —á—É–∂–∏–º ID
2. **–ù–µ—Ç rate limiting** –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
3. **–ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç DoS** (–º–∞—Å—Å–æ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)

**Server WebSocket (server/routes.ts:52-94):**
- –ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `validateSessionFromCookie()`, –Ω–æ –æ–Ω–∞ **–ù–ï –ü–†–ò–ú–ï–ù–Ø–ï–¢–°–Ø** –∫ WebSocket endpoint

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è production:
```typescript
// 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ WebSocket handshake
wss.on('connection', async (ws, req) => {
  const sessionData = await validateSessionFromCookie(req);
  if (!sessionData?.userId) {
    ws.close(1008, 'Unauthorized'); // Policy violation
    return;
  }
  
  ws.userId = sessionData.userId; // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π userId
  
  // 2. Rate limiting —Å–æ–æ–±—â–µ–Ω–∏–π
  const messageRateLimits = new Map();
  ws.on('message', (data) => {
    if (!checkRateLimit(ws.userId, messageRateLimits)) {
      ws.send(JSON.stringify({ type: 'rate_limit' }));
      return;
    }
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  });
});

// 3. Connection rate limiting
const wsConnectionLimiter = rateLimit({
  windowMs: 60 * 1000,
  max: 10, // 10 connections per IP per minute
});
app.use('/ws', wsConnectionLimiter);
```

### 2.2 NPM Audit Vulnerabilities

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏:** 28 –Ω–æ—è–±—Ä—è 2025

| –ü–∞–∫–µ—Ç | Severity | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|-------|----------|----------|--------------|
| `csurf` | Low | Cookie vulnerability + deprecated | –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ csrf-csrf |
| `cookie` (transitive) | Low | Out of bounds characters | –û–±–Ω–æ–≤–∏—Ç—Å—è —Å csurf |
| `drizzle-kit` | Moderate | @esbuild-kit/core-utils | –ú–∞–∂–æ—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (breaking) |
| `@esbuild-kit/esm-loader` | Moderate | Transitive —á–µ—Ä–µ–∑ drizzle-kit | ‚Äî |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1:** –ó–∞–º–µ–Ω–∏—Ç—å `csurf` –Ω–∞ `csrf-csrf` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SameSite cookies
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å changelog drizzle-kit –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ alerts (Dependabot, Snyk)

### 2.3 –û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| Authentication | 9/10 | Session-based, regeneration, bcrypt |
| Authorization | 8/10 | Role-based —á–µ—Ä–µ–∑ user_roles —Ç–∞–±–ª–∏—Ü—É |
| CSRF Protection | 6/10 | Deprecated –ø–∞–∫–µ—Ç, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| XSS Protection | 8/10 | React + Zod, –Ω–µ—Ç innerHTML |
| SQL Injection | 10/10 | Drizzle ORM prepared statements |
| Rate Limiting | 5/10 | In-memory (–Ω–µ production-ready) |
| File Upload | 9/10 | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è |
| WebSocket Security | 3/10 | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ |
| Session Security | 10/10 | –ò–¥–µ–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| HTTPS/TLS | N/A | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç deployment |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** 7.1/10 (—Ö–æ—Ä–æ—à–æ –¥–ª—è development, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è production)

---

## 3. –ê–ù–ê–õ–ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•

### 3.1 –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (shared/schema.ts)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–¢–∞–±–ª–∏—Ü—ã:** 15 –æ—Å–Ω–æ–≤–Ω—ã—Ö
- **–ò–Ω–¥–µ–∫—Å—ã:** 12+ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Constraints:** UNIQUE, FOREIGN KEY, ON DELETE CASCADE/SET NULL
- **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ uuid, text, integer, decimal, timestamp, jsonb

**–ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü:**

#### 3.1.1 users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
```typescript
id: varchar("id", { length: 36 }).primaryKey()
email: text("email").unique().notNull()
passwordHash: text("password_hash").notNull()
firstName, lastName, patronymic, phone
isVerified: boolean("is_verified").default(false)
bonusBalance: integer("bonus_balance").default(100)
createdAt, updatedAt: timestamp
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ –•–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ
- UUID primary key (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è distributed systems)
- Email —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å + lowercase
- Bonus system –≤—Å—Ç—Ä–æ–µ–Ω –Ω–∞–ø—Ä—è–º—É—é
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email flow –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω

**–£–ª—É—á—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `lastLoginAt` –¥–ª—è security monitoring

#### 3.1.2 user_roles (–ú–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)
```typescript
id: varchar("id").primaryKey()
userId: varchar("user_id").references(() => users.id, { onDelete: 'cascade' })
role: text("role").notNull() // 'admin' | 'marketer' | 'consultant' | 'customer'
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è RBAC
- UNIQUE constraint –Ω–∞ (userId, role) - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏
- CASCADE delete - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CHECK constraint –¥–ª—è role enum:
```sql
ALTER TABLE user_roles 
ADD CONSTRAINT check_role_enum 
CHECK (role IN ('admin', 'marketer', 'consultant', 'customer'));
```

#### 3.1.3 products (–¢–æ–≤–∞—Ä—ã)
```typescript
id: varchar(36).primaryKey()
categoryId: varchar(36).references(() => categories.id, { onDelete: 'set null' })
sku: text("sku").unique().notNull() // –ê—Ä—Ç–∏–∫—É–ª
name, description, composition, storageConditions, usageInstructions
weight, volume, dimensions (height, length, width)
shelfLifeDays: integer
stockQuantity, price, discountPercentage
discountStartDate, discountEndDate
isNew, isArchived: boolean
rating: real("rating").default(0) // 0-5
reviewsCount, viewCount: integer
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –û—á–µ–Ω—å –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è e-commerce
- SKU —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- Decimal —Ç–∏–ø—ã –¥–ª—è —Ü–µ–Ω (–∏–∑–±–µ–∂–∞–Ω–∏–µ floating point –æ—à–∏–±–æ–∫)
- Composite discount system (percentage + date range)
- Soft delete —á–µ—Ä–µ–∑ `isArchived` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤)
- `viewCount` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏

**–ò–Ω–¥–µ–∫—Å—ã (–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã):**
```typescript
// –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
index("category_id_idx").on(products.categoryId),

// –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
index("is_archived_price_idx").on(products.isArchived, products.price),
index("created_at_idx").on(products.createdAt).desc(),
index("rating_idx").on(products.rating).desc(),
```

#### 3.1.4 orders (–ó–∞–∫–∞–∑—ã)
```typescript
id: varchar(36).primaryKey()
userId: varchar(36).references(() => users.id, { onDelete: 'set null' })
orderNumber: text("order_number").unique().notNull()
status: text("status").notNull() // 'pending' | 'paid' | 'shipped' | 'delivered' | ...
items: jsonb("items").notNull() // [{product_id, name, price, quantity, discount}]
subtotal, discountAmount, bonusesUsed, bonusesEarned: real
promocodeId: varchar(36).references(() => promocodes.id)
deliveryService, deliveryType, deliveryPointCode, deliveryAddress: jsonb
deliveryCost, total: real
paymentMethod, paymentStatus: text
yukassaPaymentId: text (nullable)
paidAt, shippedAt, deliveredAt, completedAt: timestamp
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ö–µ–º–∞ –∑–∞–∫–∞–∑–∞
- **JSONB –¥–ª—è items** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä (snapshot —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞)
- **Bonuses tracking** - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ
- **Delivery flexibility** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ü–í–ó, –ø–æ—Å—Ç–∞–º–∞—Ç–æ–≤, –∫—É—Ä—å–µ—Ä–∞
- **Payment integration** - yukassaPaymentId –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- **Status tracking** - timestamps –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CHECK constraint –¥–ª—è enum –ø–æ–ª–µ–π:
```sql
CHECK (status IN ('pending', 'paid', 'shipped', 'delivered', 'completed', 'cancelled'))
CHECK (deliveryService IN ('cdek', 'boxberry'))
CHECK (deliveryType IN ('pvz', 'postamat', 'courier'))
CHECK (paymentMethod IN ('online', 'on_delivery'))
CHECK (paymentStatus IN ('pending', 'paid', 'failed'))
```

#### 3.1.5 promocodes (–ü—Ä–æ–º–æ–∫–æ–¥—ã)
```typescript
id: varchar(36).primaryKey()
code: text("code").unique().notNull() // "SALE20"
discountPercentage: real.notNull() // 0-100
minOrderAmount, maxOrderAmount: real
type: text("type").notNull() // 'single_use' | 'temporary'
expiresAt: timestamp (nullable)
isActive: boolean.default(true)
createdByUserId: varchar(36).references(() => users.id)
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- **Single-use vs Temporary** - —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- **Min/max constraints** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏
- **Audit trail** - createdByUserId –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

**–¢–∞–±–ª–∏—Ü–∞ promocode_usage:**
```typescript
UNIQUE constraint –Ω–∞ (promocode_id, user_id) // –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å CHECK –¥–ª—è discountPercentage:
```sql
CHECK (discount_percentage >= 0 AND discount_percentage <= 100)
```

#### 3.1.6 support_messages + support_message_attachments (–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
```typescript
support_messages:
  userId: –∫–ª–∏–µ–Ω—Ç
  senderId: –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (–º–æ–∂–µ—Ç –±—ã—Ç—å –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç)
  messageText: text (nullable, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –≤–ª–æ–∂–µ–Ω–∏–µ)
  isRead: boolean
  
support_message_attachments:
  messageId: FK
  fileUrl, fileSize, fileType: text
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —á–∞—Ç–∞
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ message –∏ attachments (1-to-many)
- `senderId` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `isRead` –¥–ª—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–£–ª—É—á—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:
```typescript
index("user_is_read_idx").on(supportMessages.userId, supportMessages.isRead)
```

### 3.2 Database Connection (server/db.ts)

```typescript
export const pool = new Pool({ 
  connectionString: process.env.DATABASE_URL,
  max: 20,                      // –ú–∞–∫—Å–∏–º—É–º 20 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
  idleTimeoutMillis: 30000,     // 30 —Å–µ–∫—É–Ω–¥ idle timeout
  connectionTimeoutMillis: 10000, // 10 —Å–µ–∫—É–Ω–¥ connection timeout
});
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ Production-ready –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Connection pooling - –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- `max: 20` - –∞–¥–µ–∫–≤–∞—Ç–Ω–æ –¥–ª—è small-medium traffic
- Timeouts –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º:**
```typescript
max: parseInt(process.env.DB_POOL_SIZE || '20'),
// + pgBouncer –¥–ª—è connection pooling –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL
```

### 3.3 –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ü–æ–¥—Ö–æ–¥:** `drizzle-kit push` (schema-first)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚ö†Ô∏è –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `drizzle-kit generate`

### 3.4 –û—Ü–µ–Ω–∫–∞ –ë–î

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è | 9/10 | 3NF, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è | 7/10 | –û—Å–Ω–æ–≤–Ω—ã–µ –µ—Å—Ç—å, –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ |
| –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö | 10/10 | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è |
| Constraints | 8/10 | FK –µ—Å—Ç—å, CHECK constraints –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å |
| Scalability | 8/10 | UUID PKs, JSONB, —Ö–æ—Ä–æ—à–æ –¥–ª—è horizontal scaling |
| Performance | 7/10 | –ù—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 8.2/10

---

## 4. –ê–ù–ê–õ–ò–ó BACKEND

### 4.1 API Routes (server/routes.ts)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** RESTful API —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/api`

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ endpoints:**

#### 4.1.1 Authentication & Users (9 endpoints)
```
POST   /api/auth/register         - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
GET    /api/auth/verify-email     - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
POST   /api/auth/login            - –í—Ö–æ–¥
POST   /api/auth/logout           - –í—ã—Ö–æ–¥
GET    /api/auth/me               - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
PATCH  /api/users/profile         - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
GET    /api/users/addresses       - –°–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
POST   /api/users/addresses       - –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
DELETE /api/users/addresses/:id   - –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ Session regeneration –ø—Ä–∏ login (–∑–∞—â–∏—Ç–∞ –æ—Ç session fixation)
- ‚úÖ Email verification flow
- ‚úÖ Password hashing —Å bcrypt (cost factor 10)
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç rate limiting –Ω–∞ `/api/auth/logout` (minor issue)

#### 4.1.2 Products & Categories (6 endpoints)
```
GET    /api/categories            - –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
POST   /api/categories            - –°–æ–∑–¥–∞–Ω–∏–µ (admin/marketer)
GET    /api/products              - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
GET    /api/products/:id          - –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
POST   /api/products              - –°–æ–∑–¥–∞–Ω–∏–µ (admin/marketer)
PATCH  /api/products/:id          - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ (admin/marketer)
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: categoryId, minPrice, maxPrice, search
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: price_asc/desc, popularity, newest, rating
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è: page, limit (default 30)
- ‚úÖ Role-based access –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ `viewCount` –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ç–æ–≤–∞—Ä–∞
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç rate limiting –Ω–∞ `/api/products` search (–µ—Å—Ç—å searchLimiter, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)

#### 4.1.3 Cart & Orders (5 endpoints)
```
GET    /api/cart                  - –ö–æ—Ä–∑–∏–Ω–∞
POST   /api/cart/add              - –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
PATCH  /api/cart/:id              - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
DELETE /api/cart/:id              - –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
POST   /api/orders                - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
GET    /api/orders                - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
GET    /api/orders/:id            - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ user_id (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (order + promocode usage + bonus update)
- ‚úÖ Calculation: subtotal, discount, bonuses, delivery cost, total
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ stock_quantity –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É (race condition risk)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å optimistic locking –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ checkout:
```typescript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
const product = await db.query.products.findFirst({
  where: eq(products.id, item.productId)
});

if (product.stockQuantity < item.quantity) {
  throw new ConflictError(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ "${product.name}"`);
}

// –£–º–µ–Ω—å—à–∏—Ç—å stock –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
await db.update(products)
  .set({ stockQuantity: sql`${products.stockQuantity} - ${item.quantity}` })
  .where(eq(products.id, item.productId));
```

#### 4.1.4 Promocodes (2 endpoints)
```
POST   /api/promocodes/validate   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
POST   /api/promocodes            - –°–æ–∑–¥–∞–Ω–∏–µ (admin/marketer)
```

**–õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (server/promocodes.ts):**
1. –ù–∞–π—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ (case-insensitive)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `isActive`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `expiresAt`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `minOrderAmount` / `maxOrderAmount`
5. –î–ª—è temporary: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `promocode_usage`
6. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–∫–∏–¥–∫—É

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 4.1.5 Support Chat (WebSocket + HTTP)
```
WebSocket /ws                      - Real-time —á–∞—Ç
GET    /api/support/conversations  - –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (consultant/admin)
POST   /api/support/messages       - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
POST   /api/support/messages/upload - –ó–∞–≥—Ä—É–∑–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π (max 7 files, 10MB each)
PATCH  /api/support/messages/read  - –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
```

**WebSocket —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// Broadcast –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º
wss.clients.forEach((client) => {
  if (client.userId && hasRole(client.userId, ['admin', 'consultant'])) {
    client.send(JSON.stringify({ type: 'new_message', ... }));
  }
});
```

**–ü—Ä–æ–±–ª–µ–º—ã:** üî¥ (—Å–º. —Ä–∞–∑–¥–µ–ª 2.1.7 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### 4.2 Middleware

#### 4.2.1 Error Handler (server/middleware/errorHandler.ts)
```typescript
class AppError extends Error {
  statusCode: number;
  isOperational: boolean;
}

// –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
class ValidationError extends AppError { statusCode: 400 }
class AuthenticationError extends AppError { statusCode: 401 }
class AuthorizationError extends AppError { statusCode: 403 }
class NotFoundError extends AppError { statusCode: 404 }
class ConflictError extends AppError { statusCode: 409 }
```

**–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:**
```typescript
export function errorHandler(err, req, res, next) {
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å requestId
  // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É (–±–µ–∑ stack trace –≤ production)
  // 500 –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫
}
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–µ—Ç stack traces –≤ production)

#### 4.2.2 Request Logging (server/middleware/requestLogging.ts)
```typescript
export function requestLogging(req, res, next) {
  const requestId = nanoid(10);
  req.requestId = requestId;
  
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    console.log(`[${requestId}] ${req.method} ${req.path} - ${res.statusCode} (${duration}ms)`);
  });
}
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ë–∞–∑–æ–≤—ã–π request tracing
**–£–ª—É—á—à–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å structured logging (Winston, Pino):
```typescript
logger.info({
  requestId,
  method: req.method,
  path: req.path,
  statusCode: res.statusCode,
  duration,
  userId: req.session?.userId,
});
```

#### 4.2.3 Authorization (server/middleware/requireRole.ts)
```typescript
export function requireRole(...allowedRoles: string[]) {
  return (req, res, next) => {
    if (!req.isAuthenticated()) {
      return next(new AuthenticationError());
    }
    
    const userRoles = req.user?.roles || [];
    const hasRole = allowedRoles.some(role => userRoles.includes(role));
    
    if (!hasRole) {
      return next(new AuthorizationError());
    }
    next();
  };
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
app.post('/api/products', requireRole('admin', 'marketer'), async (req, res) => {
  // –¢–æ–ª—å–∫–æ admin –∏–ª–∏ marketer
});
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RBAC
- –ì–∏–±–∫–æ—Å—Ç—å (–Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ä–æ–ª–µ–π)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞

### 4.3 Image Processing (server/ImagePipeline.ts)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```typescript
class ImagePipeline {
  - uploadsDir: string
  - tempDir: string (.temp subdirectory)
  - config: { maxWidth, maxHeight, quality, format }
  - tempFiles: Map<string, timestamp> // Tracking –¥–ª—è cleanup
  - cleanupInterval: NodeJS.Timeout // Periodic cleanup –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
}
```

**Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. **–°–æ–∑–¥–∞–Ω–∏–µ temp —Ñ–∞–π–ª–∞** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - —Ä–∞–∑–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç, dimensions (max 10000x10000)
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ Sharp:**
   - Resize (–µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç maxWidth/maxHeight)
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WebP (–∫–∞—á–µ—Å—Ç–≤–æ 85%)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ temp output
4. **Atomic rename** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
5. **Cleanup** - —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–±–æ–µ–≤:**
```typescript
try {
  const result = await processImage(buffer, originalName);
  return result;
} catch (error) {
  await tempFile.cleanup(); // –£–¥–∞–ª–µ–Ω–∏–µ temp —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  if (tempOutputPath) {
    await fs.unlink(tempOutputPath);
  }
  throw error;
}
```

**Batch processing —Å rollback:**
```typescript
async processBatch(files) {
  const results = [];
  const processedFiles = [];
  
  try {
    for (const file of files) {
      const result = await processImage(file.buffer, file.originalname);
      results.push(result);
      processedFiles.push(path.join(this.uploadsDir, result.filename));
    }
    return results;
  } catch (error) {
    // –û—Ç–∫–∞—Ç –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    for (const filePath of processedFiles) {
      await fs.unlink(filePath);
    }
    throw error;
  }
}
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ Enterprise-grade —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
- Automatic resource cleanup
- Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Memory-efficient (stream processing)

**–ò–Ω—Å—Ç–∞–Ω—Å—ã:**
```typescript
productImagePipeline: 1200x1200, quality 85, WebP
chatImagePipeline: 800x800, quality 80, WebP
```

### 4.4 –û—Ü–µ–Ω–∫–∞ Backend

| –ö–∞—Ç–µ–≥–æ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| API Design | 9/10 | RESTful, –ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| Error Handling | 10/10 | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è |
| Validation | 9/10 | Zod schemas, sanitization |
| Authorization | 9/10 | RBAC, session-based |
| File Processing | 10/10 | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è ImagePipeline |
| Code Organization | 9/10 | –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| Transaction Safety | 7/10 | –ï—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 9.0/10

---

## 5. –ê–ù–ê–õ–ò–ó FRONTEND

### 5.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (client/src/App.tsx):**
```tsx
<QueryClientProvider>
  <ThemeProvider>
    <AuthProvider>
      <CartLoader />
      <TooltipProvider>
        <Toaster />
        <ErrorBoundary>
          <Suspense fallback={<PageLoadingFallback />}>
            <Router />
          </Suspense>
          <SupportChatLauncher />
        </ErrorBoundary>
      </TooltipProvider>
    </AuthProvider>
  </ThemeProvider>
</QueryClientProvider>
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è providers
- `QueryClientProvider` –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ (–¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- `AuthProvider` –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–¥–æ—Å—Ç—É–ø –∫ user context)
- `ErrorBoundary` –ª–æ–≤–∏—Ç React –æ—à–∏–±–∫–∏
- `Suspense` –¥–ª—è code splitting (lazy routes)

### 5.2 State Management

#### 5.2.1 Zustand Stores

**authStore (client/src/stores/authStore.ts):**
```typescript
interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  authInitialized: boolean; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç flash of unauthenticated content
  
  login: (user: User) => void;
  logout: () => Promise<void>;
  checkAuth: () => Promise<void>;
}
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π
- `authInitialized` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- `checkAuth()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ AuthProvider –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**cartStore:**
```typescript
interface CartState {
  items: CartItem[];
  loadCart: () => Promise<void>;
  addItem: (productId: string, quantity: number) => Promise<void>;
  updateQuantity: (cartItemId: string, quantity: number) => Promise<void>;
  removeItem: (cartItemId: string) => Promise<void>;
  clear: () => void;
}
```

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (add/update/remove) –¥–µ–ª–∞—é—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
- `CartLoader` component –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- Optimistic updates –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è UX)

#### 5.2.2 React Query

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (client/src/lib/queryClient.ts):**
```typescript
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5, // 5 –º–∏–Ω—É—Ç
      refetchOnWindowFocus: false,
    },
  },
});
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:**
```typescript
// –ü—Ä–∏–º–µ—Ä: useProducts hook
const { data, isLoading, error } = useQuery({
  queryKey: ['products', filters],
  queryFn: () => productsApi.getAll(filters),
});
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `staleTime: 5 min` - –±–∞–ª–∞–Ω—Å —Å–≤–µ–∂–µ—Å—Ç–∏/–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `refetchOnWindowFocus: false` - –∏–∑–±–µ–∂–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
```typescript
queries: {
  retry: (failureCount, error) => {
    if (error.status === 404 || error.status === 403) return false;
    return failureCount < 2;
  },
}
```

### 5.3 Routing (Wouter)

**–ú–∞—Ä—à—Ä—É—Ç—ã (client/src/App.tsx:48-122):**
```tsx
// Public routes
<Route path="/" component={HomePage} />
<Route path="/catalog" component={CatalogPage} />
<Route path="/products/:id" component={ProductDetailPage} />
<Route path="/login" component={LoginPage} />
<Route path="/register" component={RegisterPage} />

// Protected routes (—Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
<Route path="/cart">
  <ProtectedRoute>
    <CartPage />
  </ProtectedRoute>
</Route>

// Admin routes (—Ç—Ä–µ–±—É—é—Ç —Ä–æ–ª–∏)
<Route path="/admin/products">
  <ProtectedRoute roles={["admin", "marketer"]}>
    <AdminProductsPage />
  </ProtectedRoute>
</Route>
```

**ProtectedRoute –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
```typescript
export function ProtectedRoute({ children, roles }: Props) {
  const { user, isAuthenticated, authInitialized } = useAuthStore();
  
  if (!authInitialized) return <LoadingSpinner />;
  
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }
  
  if (roles && !hasAnyRole(user, roles)) {
    return <Navigate to="/" replace />;
  }
  
  return <>{children}</>;
}
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ß–∏—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
- `authInitialized` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º
- `replace` –≤–º–µ—Å—Ç–æ `push` (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)

### 5.4 Components

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** 106 TypeScript —Ñ–∞–π–ª–æ–≤ –≤ client/src

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
components/
‚îú‚îÄ‚îÄ ui/                 # Shadcn UI primitives (40+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx
‚îÇ   ‚îú‚îÄ‚îÄ form.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ layout/             # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ header.tsx
‚îÇ   ‚îú‚îÄ‚îÄ footer.tsx
‚îÇ   ‚îî‚îÄ‚îÄ sidebar.tsx
‚îú‚îÄ‚îÄ cart/               # –ö–æ—Ä–∑–∏–Ω–∞
‚îú‚îÄ‚îÄ products/           # –¢–æ–≤–∞—Ä—ã
‚îú‚îÄ‚îÄ admin/              # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
‚îî‚îÄ‚îÄ support-chat-launcher.tsx
```

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- ‚úÖ TypeScript —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ Shadcn UI - accessibility –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (ARIA –∞—Ç—Ä–∏–±—É—Ç—ã, keyboard navigation)
- ‚úÖ Tailwind CSS - –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ Code splitting - lazy loading —Å—Ç—Ä–∞–Ω–∏—Ü

**TODO –Ω–∞–π–¥–µ–Ω–æ:** 1 –º–µ—Å—Ç–æ (client/src/components/footer.tsx:9)
```typescript
// TODO: Implement newsletter subscription
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

### 5.5 WebSocket Client (client/src/lib/websocket.ts)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```typescript
class WebSocketClient {
  private socket: WebSocket | null;
  private reconnectTimeout: NodeJS.Timeout | null;
  private reconnectAttempts: number;
  private maxReconnectAttempts = 5;
  private messageHandlers: Set<MessageHandler>;
  
  connect(userId: string)
  disconnect()
  send(data: WebSocketMessage)
  onMessage(handler: MessageHandler): UnsubscribeFn
  isConnected(): boolean
}
```

**Reconnection strategy:**
```typescript
socket.onclose = () => {
  if (reconnectAttempts < maxReconnectAttempts) {
    const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
    // Exponential backoff: 1s, 2s, 4s, 8s, 16s, max 30s
    setTimeout(() => this.connect(userId), delay);
  }
};
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- Exponential backoff –¥–ª—è reconnection
- Multiple message handlers (pub/sub pattern)
- Unsubscribe —Ñ—É–Ω–∫—Ü–∏—è (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ memory leaks)

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ heartbeat/ping-pong
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ ping –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
this.pingInterval = setInterval(() => {
  if (this.isConnected()) {
    this.send({ type: 'ping' });
  }
}, 30000);

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ pong
socket.onmessage = (event) => {
  const message = JSON.parse(event.data);
  if (message.type === 'pong') {
    clearTimeout(this.pongTimeout);
  }
};
```

### 5.6 API Client (client/src/lib/api.ts)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```typescript
class ApiClient {
  private baseURL = '/api';
  
  async request(method, endpoint, data?, options?) {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      method,
      headers: { 'Content-Type': 'application/json', ...csrfHeaders },
      credentials: 'include', // –í–∞–∂–Ω–æ –¥–ª—è cookies
      body: data ? JSON.stringify(data) : undefined,
    });
    
    if (!response.ok) {
      throw new ApiError(response.status, await response.json());
    }
    
    return response.json();
  }
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API –æ–±—ä–µ–∫—Ç—ã
export const authApi = { login, register, logout, me, verifyEmail };
export const productsApi = { getAll, getById, create, update };
export const cartApi = { get, add, update, remove };
// ...
```

**–ê–Ω–∞–ª–∏–∑:** ‚úÖ –ß–∏—Å—Ç–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
- `credentials: 'include'` - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è session cookies
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–£–ª—É—á—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –∏ timeout:
```typescript
async request(method, endpoint, data, options = {}) {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000); // 30s timeout
  
  try {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      ...options,
      signal: controller.signal,
    });
    return response;
  } finally {
    clearTimeout(timeout);
  }
}
```

### 5.7 –û—Ü–µ–Ω–∫–∞ Frontend

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| Architecture | 9/10 | Providers hierarchy, –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å |
| State Management | 9/10 | Zustand + React Query - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ |
| Routing | 9/10 | Wouter + ProtectedRoute |
| Components | 9/10 | TypeScript, Shadcn UI, accessibility |
| WebSocket | 8/10 | Reconnection –µ—Å—Ç—å, –Ω–µ—Ç heartbeat |
| Error Handling | 8/10 | ErrorBoundary, API errors |
| Type Safety | 10/10 | –°—Ç—Ä–æ–≥–∏–π TypeScript |
| Code Splitting | 9/10 | Lazy routes, Suspense |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 8.9/10

---

## 6. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### 6.1 Database Performance

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **Missing indexes** –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
-- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å:
CREATE INDEX products_archived_price_idx ON products (is_archived, price);
CREATE INDEX products_category_archived_idx ON products (category_id, is_archived);
CREATE INDEX products_rating_idx ON products (rating DESC);
CREATE INDEX orders_user_created_idx ON orders (user_id, created_at DESC);
```

2. **N+1 queries —Ä–∏—Å–∫** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏:
```typescript
// –ü–ª–æ—Ö–æ:
const products = await db.query.products.findMany();
for (const product of products) {
  product.images = await db.query.productImages.findMany({
    where: eq(productImages.productId, product.id)
  });
}

// –•–æ—Ä–æ—à–æ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
const products = await db.query.products.findMany({
  with: { images: true }
});
```

3. **JSONB performance** –¥–ª—è `orders.items`:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (snapshot –¥–∞–Ω–Ω—ã—Ö)
- ‚ö†Ô∏è –ù–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å JOIN –ø–æ –ø–æ–ª—è–º –≤–Ω—É—Ç—Ä–∏ JSONB
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å GIN index –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫ –ø–æ items:
```sql
CREATE INDEX orders_items_gin_idx ON orders USING GIN (items);
```

### 6.2 Backend Performance

**ImagePipeline —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
- ‚úÖ Stream processing (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å)
- ‚úÖ WebP —Ñ–æ—Ä–º–∞—Ç (–ª—É—á—à–µ —Å–∂–∞—Ç–∏–µ —á–µ–º JPEG/PNG)
- ‚úÖ Quality 85 - –±–∞–ª–∞–Ω—Å —Ä–∞–∑–º–µ—Ä–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ Periodic cleanup - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ disk space leaks

**Session storage:**
- ‚úÖ PostgreSQL store - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ–µ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ `sessions` —Ç–∞–±–ª–∏—Ü—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ cleanup:
```typescript
new pgSimpleStore({
  pool,
  tableName: 'sessions',
  pruneSessionInterval: 60 * 60, // Cleanup –∫–∞–∂–¥—ã–π —á–∞—Å
});
```

### 6.3 Frontend Performance

**Code Splitting:**
```typescript
const HomePage = lazy(() => import("@/pages/home-page"));
const AdminDashboardPage = lazy(() => import("@/pages/admin/dashboard-page"));
```
‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

**React Query caching:**
```typescript
staleTime: 1000 * 60 * 5, // 5 –º–∏–Ω—É—Ç
```
‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

**Optimizations –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:**
- ‚ö†Ô∏è –ù–µ—Ç `React.memo` –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚ö†Ô∏è –ù–µ—Ç `useMemo` / `useCallback` –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç image lazy loading (`loading="lazy"`)
- ‚ö†Ô∏è –ù–µ—Ç prefetching –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
```tsx
// 1. Memo –¥–ª—è ProductCard
export const ProductCard = React.memo(({ product }) => { ... });

// 2. Image lazy loading
<img src={image.url} loading="lazy" alt={product.name} />

// 3. Prefetch —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
const prefetchNextPage = () => {
  queryClient.prefetchQuery({
    queryKey: ['products', { page: currentPage + 1 }],
    queryFn: () => productsApi.getAll({ page: currentPage + 1 }),
  });
};
```

### 6.4 Network Performance

**Bundle size:** –ù–µ –∏–∑–º–µ—Ä–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: `npm run build` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞)

**WebSocket overhead:**
- Reconnection —Å exponential backoff - ‚úÖ
- Heartbeat/ping-pong - ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**API calls:**
- Debouncing –¥–ª—è search - ‚ö†Ô∏è –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
```typescript
// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞
const debouncedSearch = useMemo(
  () => debounce((query: string) => {
    productsApi.search(query);
  }, 500),
  []
);
```

### 6.5 –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| Database Queries | 7/10 | –ù—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ |
| API Response Time | 8/10 | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–µ—Ç N+1 |
| Image Processing | 9/10 | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è WebP, stream processing |
| Frontend Bundle | N/A | –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ—Ä–µ–Ω–∏–µ |
| Caching | 8/10 | React Query –µ—Å—Ç—å, Redis rate limiting –Ω–µ—Ç |
| Real-time (WebSocket) | 7/10 | –ù–µ—Ç heartbeat, server scaling issue |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 7.8/10

---

## 7. –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –õ–£–ß–®–ò–ú –ü–†–ê–ö–¢–ò–ö–ê–ú

### 7.1 Security Best Practices

| –ü—Ä–∞–∫—Ç–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| HTTPS enforcement | ‚ö†Ô∏è | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç deployment |
| Password hashing (bcrypt) | ‚úÖ | Cost factor 10 |
| Session security | ‚úÖ | httpOnly, secure, sameSite |
| CSRF protection | ‚ö†Ô∏è | Deprecated –ø–∞–∫–µ—Ç |
| XSS protection | ‚úÖ | React + Zod |
| SQL injection protection | ‚úÖ | Drizzle prepared statements |
| Rate limiting | ‚ö†Ô∏è | In-memory (–Ω–µ production) |
| Input validation | ‚úÖ | Zod schemas |
| File upload security | ‚úÖ | Size, type, dimension validation |
| Error handling | ‚úÖ | –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç stack traces |
| Security headers | ‚úÖ | Helmet.js |
| Content Security Policy | ‚ö†Ô∏è | –ë–∞–∑–æ–≤–∞—è (–º–æ–∂–Ω–æ —É–∂–µ—Å—Ç–æ—á–∏—Ç—å) |

### 7.2 Code Quality Practices

| –ü—Ä–∞–∫—Ç–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| TypeScript strict mode | ‚úÖ | –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è |
| ESLint/Prettier | ‚ö†Ô∏è | –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| Git commits | N/A | –ù–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å |
| Code comments | ‚úÖ | –ê–¥–µ–∫–≤–∞—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ |
| TODO tracking | ‚úÖ | 1 TODO –Ω–∞–π–¥–µ–Ω |
| Error handling | ‚úÖ | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è |
| Logging | ‚úÖ | Request logging, errors |
| Testing | ‚ùå | –¢–µ—Å—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| Documentation | ‚úÖ | TODO.md (2084 —Å—Ç—Ä–æ–∫–∏) |

### 7.3 Architecture Practices

| –ü—Ä–∞–∫—Ç–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| Separation of concerns | ‚úÖ | Client/server/shared —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ |
| DRY principle | ‚úÖ | Shared schemas, reusable components |
| SOLID principles | ‚úÖ | Single Responsibility –≤ –∫–ª–∞—Å—Å–∞—Ö |
| RESTful API design | ‚úÖ | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã –∏ —Å—Ç–∞—Ç—É—Å—ã |
| Database normalization | ‚úÖ | 3NF, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ |
| Error handling strategy | ‚úÖ | –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ |
| Dependency injection | ‚ö†Ô∏è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| Configuration management | ‚úÖ | Environment variables |

### 7.4 React Best Practices

| –ü—Ä–∞–∫—Ç–∏–∫–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| Functional components | ‚úÖ | –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ |
| Hooks usage | ‚úÖ | –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
| Context providers hierarchy | ‚úÖ | QueryClient ‚Üí Theme ‚Üí Auth |
| Error boundaries | ‚úÖ | –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç Router |
| Code splitting | ‚úÖ | Lazy loading —Å—Ç—Ä–∞–Ω–∏—Ü |
| Prop drilling avoidance | ‚úÖ | Zustand, React Query |
| Memoization | ‚ö†Ô∏è | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç React.memo |
| Accessibility | ‚úÖ | Shadcn UI (ARIA –∏–∑ –∫–æ—Ä–æ–±–∫–∏) |
| Key props in lists | ‚úÖ | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ |

### 7.5 –û—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–∫—Ç–∏–∫–∞–º

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ TypeScript —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (session, CSRF, validation)
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–û–±–ª–∞—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤ (unit, integration, E2E)
- ‚ö†Ô∏è ESLint/Prettier –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–µ—Ç memoization, prefetching)
- ‚ö†Ô∏è Production readiness (Redis rate limiting, WebSocket security)

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 8.1/10

---

## 8. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò –î–õ–Ø PRODUCTION

### 8.1 CRITICAL Priority

#### 1. Rate Limiting —Å In-Memory Storage
**–†–∏—Å–∫:** DoS –∞—Ç–∞–∫–∏, –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏  
**Severity:** üî¥ CRITICAL  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** Development OK, Production BLOCKING  

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install rate-limit-redis ioredis
```

**Deployment requirements:**
- Redis server (managed service –∏–ª–∏ self-hosted)
- Environment variable: `REDIS_URL=redis://host:6379`
- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ limiters –≤ `server/middleware/rateLimiter.ts`

#### 2. WebSocket –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
**–†–∏—Å–∫:** Unauthorized –¥–æ—Å—Ç—É–ø, DoS, –∏–º–ø–µ—Ä—Å–æ–Ω–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
**Severity:** üî¥ CRITICAL  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –£—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è –∞—Ç–∞–∫  

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// 1. Validate session –ø—Ä–∏ connection
wss.on('connection', async (ws, req) => {
  const session = await validateSessionFromCookie(req);
  if (!session?.userId) {
    ws.close(1008, 'Unauthorized');
    return;
  }
  ws.userId = session.userId; // –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π userId
});

// 2. Rate limiting
const wsConnectionLimiter = rateLimit({
  windowMs: 60000,
  max: 10,
  store: new RedisStore({ ... }), // Redis!
});
app.use('/ws', wsConnectionLimiter);

// 3. Message rate limiting (in-memory –¥–æ–ø—É—Å—Ç–∏–º–æ)
const messageRateLimits = new Map(); // userId -> { count, resetAt }
```

#### 3. Missing FRONTEND_URL validation
**–†–∏—Å–∫:** CORS misconfiguration –≤ production  
**Severity:** üî¥ HIGH  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤  

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
if (env.NODE_ENV === 'production' && !env.FRONTEND_URL) {
  throw new Error('FRONTEND_URL must be set in production');
}
```

### 8.2 HIGH Priority

#### 4. CSRF –ø–∞–∫–µ—Ç deprecated
**–†–∏—Å–∫:** Security vulnerabilities, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏  
**Severity:** üü° HIGH  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ deprecated —Å –º–∞—Ä—Ç–∞ 2024  

**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ `csrf-csrf` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SameSite cookies

#### 5. NPM vulnerabilities (8 total)
**–†–∏—Å–∫:** –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö  
**Severity:** üü° MEDIUM-HIGH  

**–°–ø–∏—Å–æ–∫:**
- `csurf` (low) - deprecated + cookie vulnerability
- `drizzle-kit` (moderate) - transitive —á–µ—Ä–µ–∑ @esbuild-kit

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm audit fix
npm install csrf-csrf  # –ó–∞–º–µ–Ω–∞ csurf
npm update drizzle-kit  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å changelog
```

### 8.3 MEDIUM Priority

#### 6. Missing database indexes
**–†–∏—Å–∫:** –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö  
**Severity:** üü° MEDIUM  

**–†–µ—à–µ–Ω–∏–µ:** (—Å–º. —Ä–∞–∑–¥–µ–ª 3.3)

#### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ monitoring –∏ alerting
**–†–∏—Å–∫:** –ù–µ–≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º –≤ production  
**Severity:** üü° MEDIUM  

**–†–µ—à–µ–Ω–∏–µ:**
- Logging: Winston/Pino + aggregation (ELK, Loki)
- Metrics: Prometheus + Grafana
- Error tracking: Sentry
- Uptime monitoring: UptimeRobot, Pingdom

#### 8. No automated tests
**–†–∏—Å–∫:** –†–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–¥–∞  
**Severity:** üü° MEDIUM  

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- Unit tests: Vitest –¥–ª—è backend/frontend
- Integration tests: Supertest –¥–ª—è API
- E2E tests: Playwright –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö flow

### 8.4 Deployment Checklist

**Before Production:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `REDIS_URL`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å rate limiters –Ω–∞ RedisStore
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSocket authentication
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `FRONTEND_URL` env var
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `csurf` –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
- [ ] –û–±–Ω–æ–≤–∏—Ç—å npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å database indexes
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å logging aggregation
- [ ] –í–∫–ª—é—á–∏—Ç—å HTTPS (`NODE_ENV=production`)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å rate limiting
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**After Deployment:**
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limit violations
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ 5xx
- [ ] Performance monitoring (response times)
- [ ] Database query analysis (slow queries)

---

## 9. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### 9.1 –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:**
   - –ú–∏–≥—Ä–∞—Ü–∏—è rate limiting –Ω–∞ Redis
   - –î–æ–±–∞–≤–∏—Ç—å WebSocket authentication
   - –ó–∞–º–µ–Ω–∏—Ç—å deprecated csurf

2. **–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î**
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å ESLint + Prettier**
4. **–î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—ã–µ unit tests** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:
   - Bonuses calculation
   - Promocode validation
   - ImagePipeline

5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è frontend:**
   - React.memo –¥–ª—è ProductCard
   - Image lazy loading
   - Debounce –¥–ª—è search

### 9.2 –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - Winston/Pino –¥–ª—è structured logging
   - Sentry –¥–ª—è error tracking
   - Grafana –¥–ª—è metrics

2. **Performance optimization:**
   - Database query analysis
   - Bundle size optimization
   - CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
   - Image optimization (responsive images, WebP with JPEG fallback)

3. **Feature improvements:**
   - Implement newsletter subscription (TODO)
   - WebSocket heartbeat/ping-pong
   - Product reviews system (—Å—Ö–µ–º–∞ –µ—Å—Ç—å –≤ TODO.md)

4. **Testing:**
   - Integration tests –¥–ª—è API
   - E2E tests –¥–ª—è checkout flow

### 9.3 –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3+ –º–µ—Å—è—Ü–∞)

1. **Scalability:**
   - Horizontal scaling strategy
   - Caching layer (Redis)
   - Message queue –¥–ª—è async tasks (email, webhooks)
   - CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

2. **Advanced security:**
   - Two-factor authentication (2FA)
   - API rate limiting per user
   - Advanced threat detection
   - Regular security audits

3. **Business features:**
   - Payment integrations (–ÆKassa)
   - Delivery integrations (–°–î–≠–ö, Boxberry)
   - Analytics dashboard
   - A/B testing infrastructure

4. **Developer experience:**
   - CI/CD pipeline
   - Staging environment
   - Automated deployment
   - Documentation (API docs, component library)

---

## 10. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### 10.1 –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** 8.2/10  
**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (development):** 8.5/10  
**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (production readiness):** 6.0/10  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** 9.0/10  
**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 7.8/10  
**Maintainability:** 8.5/10  

**–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞:** 8.0/10

### 10.2 –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ frontend/backend/shared
   - –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
   - TypeScript —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Session-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–∞–¥–µ–∂–Ω–µ–µ JWT –≤ localStorage)
   - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ rate limiting (—Ç—Ä–µ–±—É–µ—Ç Redis –¥–ª—è production)
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - File upload security (ImagePipeline –∫–ª–∞—Å—Å world-class)

3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –•–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ (3NF)
   - JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ CASCADE constraints

4. **Frontend:**
   - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ (React, Zustand, React Query)
   - Accessibility (Shadcn UI)
   - Code splitting

5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - TODO.md —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø–ª–∞–Ω–æ–º (2084 —Å—Ç—Ä–æ–∫–∏)
   - SECURITY_NOTES.md —Å deployment –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

### 10.3 –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

1. **Production blockers:**
   - Rate limiting —Å in-memory storage
   - WebSocket –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - Deprecated csurf –ø–∞–∫–µ—Ç

2. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤
   - –ù–µ—Ç ESLint/Prettier –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **Monitoring:**
   - –ë–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (console.log)
   - –ù–µ—Ç metrics collection
   - –ù–µ—Ç error tracking service

### 10.4 –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ deployment

**Development:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤  
**Staging:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è Redis + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥  
**Production:** üî¥ –¢—Ä–µ–±—É—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ä–∞–∑–¥–µ–ª 8)

### 10.5 –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º–∞** –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ö–æ–¥ —á–∏—Å—Ç—ã–π, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –∏ —Å–ª–µ–¥—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. 

**–î–ª—è development –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–î–ª—è production deployment** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (Redis rate limiting, WebSocket security, CSRF migration) –∏ –¥–æ–±–∞–≤–∏—Ç—å monitoring/logging –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–ü—Ä–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å **–±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤ production** –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

---

## –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### A. –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

**Backend (22 —Ñ–∞–π–ª–∞):**
```
server/index.ts
server/routes.ts
server/db.ts
server/auth.ts
server/ImagePipeline.ts
server/middleware/errorHandler.ts
server/middleware/requestLogging.ts
server/middleware/rateLimiter.ts
server/middleware/csrf.ts
server/middleware/requireRole.ts
```

**Frontend (106 —Ñ–∞–π–ª–æ–≤):**
```
client/src/App.tsx
client/src/main.tsx
client/src/stores/authStore.ts
client/src/stores/cartStore.ts
client/src/lib/api.ts
client/src/lib/websocket.ts
client/src/lib/queryClient.ts
client/src/components/ui/* (40+ Shadcn –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
client/src/pages/* (20+ —Å—Ç—Ä–∞–Ω–∏—Ü)
```

**Shared:**
```
shared/schema.ts (Drizzle ORM + Zod schemas)
```

### B. –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)

**Frontend Dependencies:**
- react, react-dom
- @tanstack/react-query
- wouter
- zustand
- react-hook-form, zod
- @radix-ui/* (40+ UI primitives)
- tailwindcss, tailwindcss-animate
- lucide-react (icons)
- date-fns
- recharts (charts)

**Backend Dependencies:**
- express
- @neondatabase/serverless
- drizzle-orm, drizzle-kit
- bcryptjs, jsonwebtoken
- express-session, connect-pg-simple
- cors, helmet, csurf
- express-rate-limit
- multer, sharp
- ws (WebSocket)
- nodemailer
- zod, zod-validation-error

**DevDependencies:**
- typescript
- vite, @vitejs/plugin-react
- tsx (TypeScript execution)
- @types/* (type definitions)

### C. –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- **–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** TODO.md (2084 —Å—Ç—Ä–æ–∫–∏)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** SECURITY_NOTES.md (208 —Å—Ç—Ä–æ–∫)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** shared/schema.ts (–ø–æ–ª–Ω—ã–µ —Å—Ö–µ–º—ã)

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

*–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 28 –Ω–æ—è–±—Ä—è 2025*  
*–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω: Replit Agent*  
*–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞: Markdown*
