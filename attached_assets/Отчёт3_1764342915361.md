# –û–¢–ß–ï–¢ –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –£–Ø–ó–í–ò–ú–û–°–¢–Ø–ú
## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –¥–ª—è production VPS deployment

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 28 –Ω–æ—è–±—Ä—è 2024  
**–û—Ö–≤–∞—Ç:** 100% —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞  
**–¶–µ–ª—å:** –í—ã—è–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –±–∞–≥–æ–≤ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–µ—Ä–µ–¥ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –Ω–∞ VPS

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–¢–†–ï–ë–£–Æ–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø)

### 1. **Session Fixation Vulnerability**
**–§–∞–π–ª:** `server/routes.ts:238-258`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `session.regenerate()`, –Ω–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Å—Å–∏—è –Ω–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å session ID –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.

**–ö–æ–¥:**
```typescript
// routes.ts:198-199 - –£–Ø–ó–í–ò–ú–û–°–¢–¨
req.session.userId = user.id;
req.session.userRoles = roleNames;
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Session hijacking
- –ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
req.session.regenerate((err) => {
  if (err) return res.status(500).json({ message: "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" });
  req.session.userId = user.id;
  req.session.userRoles = roleNames;
  res.json({ user: {...} });
});
```

---

### 2. **SQL Injection —á–µ—Ä–µ–∑ WebSocket Cookie Parsing**
**–§–∞–π–ª:** `server/routes.ts:83`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Session ID –∏–∑ cookie –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ SQL –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–ö–æ–¥:**
```typescript
// routes.ts:83 - –ü–†–Ø–ú–ê–Ø –ò–ù–™–ï–ö–¶–ò–Ø
const result = await db.execute(sql`SELECT sess FROM session WHERE sid = ${sid}`);
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- SQL Injection
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –£—Ç–µ—á–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å session ID –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º (UUID —Ñ–æ—Ä–º–∞—Ç)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ Drizzle ORM
3. –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSRF Protection**
**–§–∞–π–ª:** –í—Å—è —Å–∏—Å—Ç–µ–º–∞  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫. Cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ CSRF —Ç–æ–∫–µ–Ω–æ–≤.

**–§–∞–π–ª—ã:**
- `server/session.ts` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–π
- –í—Å–µ POST/PUT/DELETE endpoints

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
npm install csurf
```
```typescript
import csrf from 'csurf';
const csrfProtection = csrf({ cookie: true });
app.use(csrfProtection);
```

---

### 4. **Race Condition –≤ Order Processing**
**–§–∞–π–ª:** `server/routes.ts:1163-1247`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ stock –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ù–ï –∞—Ç–æ–º–∞—Ä–Ω–æ. –ú–µ–∂–¥—É `SELECT FOR UPDATE` –∏ `UPDATE` –≤–æ–∑–º–æ–∂–µ–Ω race condition.

**–ö–æ–¥:**
```typescript
// routes.ts:1165-1176 - RACE CONDITION
const lockedProducts = await tx.execute(
  sql`SELECT * FROM products WHERE id = ${item.productId} FOR UPDATE`
);
// ... –ø—Ä–æ–≤–µ—Ä–∫–∞ stock_quantity
// routes.ts:1204-1212 - –ù–ï –ê–¢–û–ú–ê–†–ù–û
await tx.update(products)
  .set({ stockQuantity: sql`${products.stockQuantity} - ${item.quantity}` })
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Overselling (–ø—Ä–æ–¥–∞–∂–∞ –±–æ–ª—å—à–µ —Ç–æ–≤–∞—Ä–∞ —á–µ–º –µ—Å—Ç—å)
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π stock
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
await tx.execute(sql`
  UPDATE products 
  SET stock_quantity = stock_quantity - ${item.quantity},
      updated_at = NOW()
  WHERE id = ${item.productId}
    AND stock_quantity >= ${item.quantity}
  RETURNING *
`);
if (result.rows.length === 0) {
  throw new Error('INSUFFICIENT_STOCK');
}
```

---

### 5. **Bonus Balance Race Condition**
**–§–∞–π–ª:** `server/routes.ts:1214-1222`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –Ω–µ –∑–∞—â–∏—â–µ–Ω–æ –æ—Ç race condition. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã –¥–≤–∞–∂–¥—ã.

**–ö–æ–¥:**
```typescript
// routes.ts:1214-1222 - –ù–ï –ê–¢–û–ú–ê–†–ù–û
if (bonusesUsed > 0) {
  await tx.update(users)
    .set({ bonusBalance: user.bonusBalance - bonusesUsed })
    .where(eq(users.id, req.userId!));
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ –±–æ–Ω—É—Å–æ–≤ —á–µ–º –µ—Å—Ç—å
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const result = await tx.execute(sql`
  UPDATE users 
  SET bonus_balance = bonus_balance - ${bonusesUsed}
  WHERE id = ${userId} AND bonus_balance >= ${bonusesUsed}
  RETURNING *
`);
if (result.rows.length === 0) {
  throw new Error('INSUFFICIENT_BONUS');
}
```

---

### 6. **Promocode Double Spend Vulnerability**
**–§–∞–π–ª:** `server/routes.ts:1224-1242`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ order creation. –í–æ–∑–º–æ–∂–Ω–æ –¥–≤–æ–π–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

**–ö–æ–¥:**
```typescript
// routes.ts:1132-1142 - –ü–†–û–í–ï–†–ö–ê –í–ù–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
if (data.promocodeId) {
  const promocodeValidation = await validatePromocode(/*...*/);
  // ... –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –µ—Å—Ç—å –æ–∫–Ω–æ
}
// routes.ts:1224 - –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –í–ù–£–¢–†–ò –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
if (promocodeId) {
  const [promocode] = await tx.select()...
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–æ–º–æ–∫–æ–¥ single_use –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∫—É –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–µ–ª–∞—Ç—å –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. –î–æ–±–∞–≤–∏—Ç—å unique constraint –Ω–∞ `(promocodeId, userId)` –¥–ª—è temporary —Ç–∏–ø–∞

---

## üü° –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### 7. **Missing Authorization Check –≤ Cart/Wishlist**
**–§–∞–π–ª:** `server/routes.ts:482, 494, 984, 1024`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ address, cart item, wishlist item –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ –∑–∞–ø–∏—Å—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–ö–æ–¥:**
```typescript
// routes.ts:494 - –ë–ï–ó –ü–†–û–í–ï–†–ö–ò –í–õ–ê–î–ï–õ–¨–¶–ê
app.delete("/api/addresses/:id", authenticateToken, async (req, res) => {
  await storage.deleteUserAddress(req.params.id); // ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ userId
});
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—è ID
- IDOR (Insecure Direct Object Reference)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const address = await storage.getUserAddress(req.params.id);
if (!address || address.userId !== req.userId) {
  return res.status(404).json({ message: "–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω" });
}
await storage.deleteUserAddress(req.params.id);
```

---

### 8. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è Input Validation**
**–§–∞–π–ª:** `server/routes.ts:585-610`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç Zod validation.

**–ö–æ–¥:**
```typescript
// routes.ts:587 - –ë–ï–ó –í–ê–õ–ò–î–ê–¶–ò–ò
app.post("/api/categories", authenticateToken, requireRole("admin"), async (req, res) => {
  const category = await storage.createCategory(req.body); // ‚ùå
});
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- XSS —á–µ—Ä–µ–∑ injection –≤ name/description
- Database corruption —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
- DoS —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const categorySchema = z.object({
  name: z.string().min(1).max(200).trim(),
  slug: z.string().min(1).max(200).regex(/^[a-z0-9-]+$/),
  description: z.string().max(5000).optional(),
  sortOrder: z.number().int().min(0).max(9999).optional(),
});
const data = categorySchema.parse(req.body);
```

---

### 9. **Information Disclosure —á–µ—Ä–µ–∑ Error Messages**
**–§–∞–π–ª:** `server/routes.ts` (–≤–µ—Å—å —Ñ–∞–π–ª), `server/middleware/errorHandler.ts`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –ë–î —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–∞–∂–µ –≤ production.

**–ö–æ–¥:**
```typescript
// errorHandler.ts:53-60 - –ò–ù–§–û–†–ú–ê–¶–ò–Ø –í PRODUCTION
res.status(error.statusCode || 500).json({
  success: false,
  error: {
    message: process.env.NODE_ENV === 'production'
      ? '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'
      : error.message, // ‚ùå –£—Ç–µ—á–∫–∞ –≤ dev —Ä–µ–∂–∏–º–µ –Ω–∞ prod —Å–µ—Ä–≤–µ—Ä–µ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –†–∞—Å–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—É—Ç—è—Ö
- –ü–æ–º–æ—â—å –∞—Ç–∞–∫—É—é—â–µ–º—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å generic –æ—à–∏–±–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å error codes –≤–º–µ—Å—Ç–æ messages

---

### 10. **Missing Rate Limiting –Ω–∞ Critical Endpoints**
**–§–∞–π–ª:** `server/routes.ts:1106-1269`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Order creation endpoint –Ω–µ –∏–º–µ–µ—Ç rate limiting.

**–ö–æ–¥:**
```typescript
// routes.ts:1106 - –ë–ï–ó RATE LIMITING
app.post("/api/orders", authenticateToken, async (req, res) => {
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- DoS –∞—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ –º–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- Stock depletion attack
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ payment gateway

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const orderLimiter = rateLimit({
  windowMs: 60 * 1000,
  max: 10, // 10 –∑–∞–∫–∞–∑–æ–≤ –≤ –º–∏–Ω—É—Ç—É
});
app.post("/api/orders", authenticateToken, orderLimiter, async (req, res) => {
```

---

### 11. **WebSocket Authentication Bypass**
**–§–∞–π–ª:** `server/routes.ts:99-159`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü° –í–´–°–û–ö–ê–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** WebSocket –ø—Ä–æ–≤–µ—Ä—è–µ—Ç auth —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ç–∏–ø–∞ "auth". –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è.

**–ö–æ–¥:**
```typescript
// routes.ts:142-148
if (!authenticated) {
  ws.send(JSON.stringify({
    type: "error",
    message: "–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è",
  }));
  return; // ‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å WebSocket –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- DoS —á–µ—Ä–µ–∑ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
if (!authenticated) {
  ws.send(JSON.stringify({ type: "error", message: "–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è" }));
  ws.close();
  return;
}
```

---

## üü† –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢

### 12. **Session Cookie –Ω–µ –∏–º–µ–µ—Ç Domain –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
**–§–∞–π–ª:** `server/session.ts:8-24`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Cookie –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—é—Ç domain, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ –Ω–∞ subdomain.

**–ö–æ–¥:**
```typescript
// session.ts:17-22 - –ë–ï–ó DOMAIN
cookie: {
  maxAge: 7 * 24 * 60 * 60 * 1000,
  httpOnly: true,
  secure: env.NODE_ENV === 'production',
  sameSite: 'lax', // ‚ùå –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 'strict' –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
},
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
cookie: {
  maxAge: 7 * 24 * 60 * 60 * 1000,
  httpOnly: true,
  secure: true, // –í—Å–µ–≥–¥–∞ true –Ω–∞ production
  sameSite: 'strict', // –°—Ç—Ä–æ–∂–µ –¥–ª—è e-commerce
  domain: process.env.COOKIE_DOMAIN,
},
```

---

### 13. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Password Strength Validation**
**–§–∞–π–ª:** `shared/schema.ts:562`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–∞—Ä–æ–ª—å —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ 8 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ complexity.

**–ö–æ–¥:**
```typescript
// schema.ts:562 - –°–õ–ê–ë–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø
password: z.string().min(8, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤")
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –°–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏ —Ç–∏–ø–∞ "12345678"
- –õ–µ–≥–∫–∏–π bruteforce

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
password: z.string()
  .min(8)
  .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, 
    "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞, —Ü–∏—Ñ—Ä—ã")
```

---

### 14. **Email –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
**–§–∞–π–ª:** `server/routes.ts:161-219`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Email –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ emails –≤ –±–∞–∑–µ
- –ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–∏—Å–µ–º
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (test@mail.com vs TEST@MAIL.COM)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sanitizeEmail` –∏–∑ utils –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

---

### 15. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Timeout –¥–ª—è Database Queries**
**–§–∞–π–ª:** `server/db.ts:14-15`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Connection pool –Ω–µ –∏–º–µ–µ—Ç query timeout.

**–ö–æ–¥:**
```typescript
// db.ts:14 - –ë–ï–ó TIMEOUT
export const pool = new Pool({ connectionString: process.env.DATABASE_URL });
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ó–∞–≤–∏—Å—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- DoS —á–µ—Ä–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
export const pool = new Pool({ 
  connectionString: process.env.DATABASE_URL,
  max: 20,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 10000,
  statement_timeout: 30000, // 30 sec query timeout
});
```

---

### 16. **File Upload –±–µ–∑ Antivirus Scanning**
**–§–∞–π–ª:** `server/ImagePipeline.ts:107-169`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ MIME type –∏ extension, –±–µ–∑ antivirus.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Malware upload —á–µ—Ä–µ–∑ polyglot files
- Server compromise

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ClamAV –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–≥–æ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è uploads.

---

### 17. **Memory Leak –≤ ImagePipeline**
**–§–∞–π–ª:** `server/ImagePipeline.ts:41, 210-225`  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** `tempFiles` Set –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

**–ö–æ–¥:**
```typescript
// ImagePipeline.ts:41
private tempFiles: Set<string> = new Set();
// –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –¥–æ–ª–≥–æ–π —Ä–∞–±–æ—Ç–µ
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Memory leak
- Server OOM

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ setInterval –∏–ª–∏ TTL –¥–ª—è temp files.

---

### 18. **Missing Logging –¥–ª—è Security Events**
**–§–∞–π–ª:** –í—Å–µ authentication endpoints  
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å:** üü† –°–†–ï–î–ù–Ø–Ø  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è failed login attempts, account creation, password changes.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å detect bruteforce
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ audit trail
- –°–ª–æ–∂–Ω–æ—Å—Ç—å forensics –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
console.log(JSON.stringify({
  event: 'LOGIN_FAILED',
  userId: user?.id,
  email: data.email,
  ip: req.ip,
  timestamp: new Date().toISOString(),
}));
```

---

## üîµ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ / CODE QUALITY

### 19. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Environment Variable Validation –≤ Production**
**–§–∞–π–ª:** `server/env.ts:18-40`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (EMAIL, YUKASSA) –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ production —Ä–µ–∂–∏–º–µ.

---

### 20. **Hardcoded Delivery Cost**
**–§–∞–π–ª:** `server/routes.ts:1152`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ = 300‚ÇΩ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–∞.

**–ö–æ–¥:**
```typescript
const deliveryCost = 300; // ‚ùå Hardcoded
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ API CDEK/Boxberry.

---

### 21. **Missing Index –Ω–∞ –ß–∞—Å—Ç–æ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ü–æ–ª—è**
**–§–∞–π–ª:** `shared/schema.ts`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞:
- `orders.userId + createdAt` (—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `promocodes.code` (unique –Ω–æ –±–µ–∑ explicit index)
- `supportMessages.userId + createdAt`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
index("orders_user_created_idx").on(orders.userId, orders.createdAt),
```

---

### 22. **Password Reset Function –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø
- Support overhead

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å forgot-password flow —Å —Ç–æ–∫–µ–Ω–æ–º.

---

### 23. **Rate Limiter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç In-Memory Store**
**–§–∞–π–ª:** `server/middleware/rateLimiter.ts`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –í production –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
npm install rate-limit-redis
```

---

### 24. **Missing Helmet Security Headers Configuration**
**–§–∞–π–ª:** `server/index.ts:19-34`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥–∏–µ headers (HSTS, X-Frame-Options).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
app.use(helmet({
  hsts: {
    maxAge: 31536000,
    includeSubDomains: true,
    preload: true,
  },
  frameguard: { action: 'deny' },
  contentSecurityPolicy: {...},
}));
```

---

### 25. **Product View Counter Race Condition**
**–§–∞–π–ª:** `server/storage.ts:364-369`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** Increment view count –±–µ–∑ transaction –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ lost updates.

**–ö–æ–¥:**
```typescript
// storage.ts:364-369
async incrementProductView(id: string): Promise<void> {
  await db.update(products)
    .set({ viewCount: sql`${products.viewCount} + 1` })
    .where(eq(products.id, id));
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ—Ç–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É product_views –∏–ª–∏ Redis –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

---

### 26. **Missing Transaction Rollback –≤ Order Creation**
**–§–∞–π–ª:** `server/routes.ts:1250-1269`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ—Å–ª–µ transaction –Ω–µ—Ç rollback stock.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Stock already decreased –¥–∞–∂–µ –µ—Å–ª–∏ order failed
- Data inconsistency

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–µ—Å—å order flow –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

---

### 27. **WebSocket Reconnection –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã**
**–§–∞–π–ª:** `client/src/lib/websocket.ts:67-75`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ reconnect –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–∂–µ –µ—Å—Ç—å.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Multiple connections –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
if (connectedUsers.has(userId)) {
  connectedUsers.get(userId).ws.close();
}
connectedUsers.set(userId, { ws, roles: userRoles });
```

---

### 28. **Missing Input Sanitization –≤ Search**
**–§–∞–π–ª:** `server/storage.ts:251-257`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –•–æ—Ç—è –µ—Å—Ç—å sanitization, escape –¥–ª—è LIKE –Ω–µ –ø–æ–ª–Ω—ã–π.

**–ö–æ–¥:**
```typescript
// storage.ts:251
const sanitizedSearch = filters.search.replace(/[%_\\]/g, '\\$&');
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ SQL keywords –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã.

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ù–ê–ô–î–ï–ù–ù–´–• –ü–†–û–ë–õ–ï–ú

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ | –í—ã—Å–æ–∫–∏–µ | –°—Ä–µ–¥–Ω–∏–µ | –ù–∏–∑–∫–∏–µ | –í—Å–µ–≥–æ |
|-----------|-------------|---------|---------|--------|-------|
| **Security** | 6 | 6 | 6 | 0 | 18 |
| **Logic/Business** | 0 | 0 | 2 | 3 | 5 |
| **Performance** | 0 | 0 | 2 | 1 | 3 |
| **Code Quality** | 0 | 0 | 0 | 2 | 2 |
| **–ò–¢–û–ì–û** | **6** | **6** | **10** | **6** | **28** |

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –§–∞–∑–∞ 1 (–°–†–û–ß–ù–û - –¥–æ –¥–µ–ø–ª–æ—è –Ω–∞ VPS):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Session Fixation (#1)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é session ID –≤ WebSocket (#2)
3. ‚úÖ –í–Ω–µ–¥—Ä–∏—Ç—å CSRF protection (#3)
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å race condition –≤ orders (#4)
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å bonus race condition (#5)
6. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å promocode double spend (#6)

### –§–∞–∑–∞ 2 (–ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è):
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å authorization checks (#7)
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å input validation (#8)
9. ‚úÖ –°–∫—Ä—ã—Ç—å error messages –≤ production (#9)
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ orders (#10)
11. ‚úÖ –ó–∞–∫—Ä—ã—Ç—å WebSocket –ø—Ä–∏ unauth (#11)

### –§–∞–∑–∞ 3 (–ü–µ—Ä–≤—ã–π –º–µ—Å—è—Ü):
12-18. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 4 (Continuous):
19-28. Code quality improvements

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### Infrastructure:
1. **WAF (Web Application Firewall):**
   - Cloudflare –∏–ª–∏ nginx ModSecurity
   - –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS, bot attacks

2. **Database:**
   - Enable PostgreSQL connection pooling (PgBouncer)
   - Regular automated backups
   - Point-in-time recovery –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

3. **Monitoring:**
   - Sentry –¥–ª—è error tracking
   - Prometheus + Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ELK stack –∏–ª–∏ Loki

4. **SSL/TLS:**
   - Let's Encrypt —Å auto-renewal
   - Minimum TLS 1.2
   - HSTS header –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

5. **Secrets Management:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault –∏–ª–∏ AWS Secrets Manager
   - –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å .env –≤ git

### Code:
1. **Testing:**
   - Unit tests –¥–ª—è business logic
   - Integration tests –¥–ª—è API
   - Security tests (OWASP ZAP)

2. **CI/CD:**
   - Automated security scanning (Snyk)
   - Dependency vulnerability checks
   - Code quality gates (ESLint, TypeScript strict)

3. **Documentation:**
   - API documentation (Swagger/OpenAPI)
   - Security incident response plan
   - Disaster recovery procedures

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø –î–õ–Ø VPS

1. **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ production:**
   - `NODE_ENV=production` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
   - –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ dev dependencies
   - –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **Firewall –ø—Ä–∞–≤–∏–ª–∞:**
   - –û—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ 80, 443 –ø–æ—Ä—Ç—ã
   - SSH —Ç–æ–ª—å–∫–æ —Å whitelist IP
   - –ó–∞–∫—Ä—ã—Ç—å PostgreSQL –ø–æ—Ä—Ç –∏–∑–≤–Ω–µ

3. **Process Management:**
   - PM2 –∏–ª–∏ systemd –¥–ª—è auto-restart
   - Graceful shutdown –ø—Ä–∏ SIGTERM
   - Health checks endpoint

4. **Backup Strategy:**
   - Daily automated backups
   - Offsite backup storage
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –µ–∂–µ–º–µ—Å—è—á–Ω–æ

5. **Security Updates:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ security updates –¥–ª—è OS
   - –†–µ–≥—É–ª—è—Ä–Ω—ã–π npm audit
   - Monitoring CVE –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –í–û–ü–†–û–°–û–í

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.

**–ö–û–ù–ï–¶ –û–¢–ß–ï–¢–ê**
